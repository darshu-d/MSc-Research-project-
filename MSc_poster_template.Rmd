---
title: Handling Multiple Outcomes in Health Data
author:
  - name: Sivakamakshi Muthu Kumarasamy
  - name: Shivadarshini Sreekanth
    affil: 1
affiliation:
  - num: 1
    address: School of Mathematical and Statistical Sciences, University of Galway
logoleft_name: https&#58;//sport.universityofgalway.ie/assets/img/logo2.png

poster_height: "594mm"
poster_width: "841mm"
column_numbers: 4
column_margins: "0.5in"

primary_colour: "#a80050"
secondary_colour: "#84003d"
accent_colour: "#e6007e"

author_textcol: "white"
title_textsize: "90pt"
author_textsize: "60pt"
body_textsize: "25pt"

output:
  posterdown::posterdown_html:
    self_contained: true
    pandoc_args: --mathjax
    number_sections: false
---

```{css, echo=FALSE}
/* Layout tweaks */
div.logo_left{ width: 20%; }
div.poster_title{ width: 80%; }

/* Column breaks */
.section h4 { break-after: column; }

/* Footnotes */
div.footnotes { font-size: 18pt; }

.table-wrap{
  max-width: 100%;
  overflow-x: auto;
}
.table-wrap th,
.table-wrap td,
table th,
table td {
  font-size: 22pt !important; 
  padding: 8px 10px !important;
  line-height: 1.25 !important;
}
table thead th {
  font-size: 24pt !important;
  font-weight: 600;
}
}
.callout{
  border-left: 10px solid #e6007e;
  background: rgba(230,0,126,0.08);
  padding: 16px 18px;
  border-radius: 14px;
  margin: 10px 0 14px 0;
}
.callout h3, .callout h4{ margin-top: 0; }
.small{ font-size: 20pt; }

.section h1, 
.section h2 {
  font-size: 48pt !important;   
  padding: 10px 18px !important;
  line-height: 1.1 !important;
}
.section {
  align-items: flex-start !important;
}
.table-wrap {
  float: none !important;
  clear: both !important;
}
h3, h4 {
  margin-bottom: 6px !important;
}
.table-wrap, table, .callout, pre, blockquote {
  break-inside: avoid !important;
  page-break-inside: avoid !important;
  -webkit-column-break-inside: avoid !important;
}
h3, h4 {
  break-after: avoid !important;
  page-break-after: avoid !important;
}

.cox-block{
  break-inside: avoid !important;
  -webkit-column-break-inside: avoid !important;
  page-break-inside: avoid !important;
}
pre, code {
  white-space: pre-wrap !important;
  overflow-wrap: anywhere !important;
  word-break: break-word !important;
  font-size: 16pt !important;
}
```
<!-- Don't change anything above, except the title and author names, unless you know what you are doing. -->

```{r, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, warning = FALSE, message = FALSE,
  fig.align = "center", out.width = "100%"
)

options(knitr.table.format = "html")

library(tidyverse)
library(survival)
library(survminer)
library(kableExtra)
library(table1)
library(dplyr)
library(table1)
```

```{r setup-data, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(dplyr)
library(survival)
library(survminer)
library(table1)

SECOMBIT <- read.csv("Secombit data.csv", check.names = FALSE)

# ---- HARD CHECK: stop knitting if any required column is missing ----
required_cols <- c("ordine","ARM","sites","ULN_LDH","TMB","JAK","OS","status","PFS TOTAL","Progr total")
missing_cols <- setdiff(required_cols, names(SECOMBIT))
if (length(missing_cols) > 0) {
  stop("Missing columns in CSV: ", paste(missing_cols, collapse = ", "),
       "\n\nAvailable columns are:\n", paste(names(SECOMBIT), collapse = ", "))
}

to_event01 <- function(x) {
  if (is.factor(x)) x <- as.character(x)
  x_chr <- trimws(tolower(as.character(x)))
  suppressWarnings(x_num <- as.numeric(x_chr))
  if (mean(is.na(x_num)) < 0.5) {
    return(ifelse(is.na(x_num), NA, ifelse(x_num > 0, 1, 0)))
  }
  event_labels    <- c("1","event","dead","death","progressed","progression","yes","true")
  censored_labels <- c("0","censored","alive","no","false")
  ifelse(x_chr %in% event_labels, 1,
         ifelse(x_chr %in% censored_labels, 0, NA))
}

clean_df <- SECOMBIT %>%
  transmute(
    id = ordine,
    Arm   = factor(ARM, levels = c("A","B","C")),
    Sites = factor(sites, levels = c("1-2", ">=3"), labels = c("1 - 2", ">= 3")),
    LDH   = factor(ULN_LDH, levels = c("normal","elevated"), labels = c("Normal","Elevated")),
    TMB   = factor(TMB, levels = c("<10",">=10"), labels = c("< 10", ">= 10")),
    JAK   = factor(JAK, levels = c("wt","mut"), labels = c("Wild Type (Normal)", "Mutated")),
    os_time   = suppressWarnings(as.numeric(OS)),
    os_status = to_event01(status),
    pfs_time   = suppressWarnings(as.numeric(`PFS TOTAL`)),
    pfs_status = to_event01(`Progr total`)
  ) %>%
  filter(!is.na(os_time), !is.na(os_status), !is.na(pfs_time), !is.na(pfs_status))
```

# Background and Problem

Health research often involves *multiple outcomes* (e.g., survival, disease progression, quality-of-life scores). Traditional approaches analyse outcomes separately, implicitly treating outcomes as independent and potentially missing biological and temporal links. Alternatively, composite endpoints can be used but may hide heterogeneity in clinical importance, frequency, and treatment response. As a result, both predictive performance and clinical interpretability may be compromised.

<div class="callout"> <h3>Emerging Methods</h3> <ul class="small"> <li>*Clinical trials:* Win-ratio preserves the hierarchy of endpoints importance while combining the analysis of the affect.</li> <li>*Prediction:* Multi-state models can be used to model a process where subjects transition from one state to the next. And multi-task models are deep learning models which use common pathways to predict multi outcomes of interest.</li> </ul> </div>

# Objectives of Project

Compare strategies for both clinical trial design and prediction modelling that treat outcomes independently, as composite endpoints, and via hierarchical/multi-state frameworks (with potential extension to multi-task modelling).

# Data Source

<div class="callout"> <h3>Dataset Overview </h3> <ul class="small"> <li><b>SECOMBIT Trial</b>: Phase II randomised; N ≈ 209 metastatic melanoma; 3 arms.</li> <li><b>Endpoints</b>: Overall Survival (OS) and Progression Free Survival (PFS).</li> <li><b>Covariates</b>: Sites, Lactate Dehydrogenase (LDH), Tumour Mutational Burden (TMB), a genetic biomarker (JAK). </li> </ul> </div>

This data set is used for both clinical trial and predictive modelling. In this clinical trial, the three treatment arms were considered as different combinations of first-line treatment strategies with a primary otucome of Overall Survival and secondary outcomes included Progression-Free Survival.

<!-- This #### below causes the columns to break -->

<!-- You can change where you put these breaks, and the "column_numbers: 4" argument in the YAMLS header to change the layout of the poster, with care! -->

# Preliminary Analysis

### Early Results and Descriptive Statistics

Preliminary time-to-event analyses was conducted for Overall Survival (OS) and Progression-Free Survival (PFS) separately. Survival distributions are visualised using Kaplan–Meier curves. There was no evidence of a difference in OS between three treatment arms (log-rank test :  chi-sqaured = 2.8, p-value = 0.20). Cox proportional hazards models are fitted to estimate covariate-adjusted effects, and as a preliminary predictive modelling strategy.

Results are interpreted in both clinical and methodological contexts, highlighting the limitations of analysing multiple outcomes independently and motivating integrated modelling approaches.

### Baseline Summary Table (by Arm)

```{r baseline-table, results="asis"}
label(clean_df$Sites) <- "Sites"
label(clean_df$LDH)   <- "LDH"
label(clean_df$TMB)   <- "TMB"
label(clean_df$JAK)   <- "JAK"

table1(~ Sites + LDH + TMB + JAK | Arm,
       data = clean_df,
       overall = FALSE)
```
### Kaplan - Meier Plot

```{r standard-plot, out.width='90%', fig.cap='Overall Survival (OS) by treatment arm.', fig.height=4, echo=FALSE}
fit_os <- survfit(Surv(os_time, os_status) ~ Arm, data = clean_df)

ggsurvplot(
  fit_os, data = clean_df,
  xlab = "Time (months)",
  ylab = "Survival probability",
  title = "Overall Survival (OS)",
  risk.table = TRUE,
  pval = TRUE,
  conf.int = TRUE
)
```

```{r km-pfs, out.width='90%', fig.cap='Progression-Free Survival (PFS) by treatment arm.', fig.height=4, echo=FALSE}
fit_pfs <- survfit(Surv(pfs_time, pfs_status) ~ Arm, data = clean_df)

ggsurvplot(
  fit_pfs, data = clean_df,
  xlab = "Time (months)",
  ylab = "Survival probability",
  title = "Progression-Free Survival (PFS)",
  risk.table = TRUE,
  pval = TRUE,
  conf.int = TRUE
)
```


### Log-rank tests

```{r logrank-table, results="asis", echo=FALSE}
logrank_os  <- survdiff(Surv(os_time, os_status) ~ Arm, data = clean_df)
logrank_pfs <- survdiff(Surv(pfs_time, pfs_status) ~ Arm, data = clean_df)

p_os  <- 1 - pchisq(logrank_os$chisq,  df = length(logrank_os$n)  - 1)
p_pfs <- 1 - pchisq(logrank_pfs$chisq, df = length(logrank_pfs$n) - 1)

logrank_tab <- data.frame(
  Endpoint = c("OS", "PFS"),
  `Chi-square` = round(c(logrank_os$chisq, logrank_pfs$chisq), 2),
  df = c(length(logrank_os$n)-1, length(logrank_pfs$n)-1),
  `p-value` = signif(c(p_os, p_pfs), 3)
)

knitr::kable(logrank_tab, format = "html", align = "lccc") |>
  kableExtra::kable_styling(full_width = TRUE, font_size = 18)
```

```{r cox-tables, results="asis", echo=FALSE}
library(broom)

cox_os  <- coxph(Surv(os_time, os_status) ~ Arm + Sites + LDH + TMB + JAK,
                 data = clean_df, ties = "efron")
cox_pfs <- coxph(Surv(pfs_time, pfs_status) ~ Arm + Sites + LDH + TMB + JAK,
                 data = clean_df, ties = "efron")

tidy_cox <- function(fit, title){
  broom::tidy(fit, exponentiate = TRUE, conf.int = TRUE) |>
    mutate(
      HR_CI = sprintf("%.2f (%.2f–%.2f)", estimate, conf.low, conf.high),
      p = signif(p.value, 3)
    ) |>
    select(term, HR_CI, p) |>
    rename(Variable = term, `HR (95% CI)` = HR_CI, `p-value` = p) |>
    (\(df){
      cat(paste0("<b>", title, "</b>"))
      knitr::kable(df, format="html", escape=TRUE) |>
        kableExtra::kable_styling(full_width=TRUE, font_size=18)
    })()
}

tidy_cox(cox_os,  "Cox model — Overall Survival (OS)")
cat("<br>")
tidy_cox(cox_pfs, "Cox model — Progression-Free Survival (PFS)")
```
### plot - Ph Test
```{r ph-global, results="asis", echo=FALSE}
ph_os  <- cox.zph(cox_os)
ph_pfs <- cox.zph(cox_pfs)

ph_tab <- data.frame(
  Endpoint = c("OS", "PFS"),
  `PH test p-value` = signif(c(ph_os$table["GLOBAL","p"], ph_pfs$table["GLOBAL","p"]), 3)
)

knitr::kable(ph_tab, format="html") |>
  kableExtra::kable_styling(full_width=TRUE, font_size=18)
```

# Future Work
- Compare independent outcome assessment with composite outcome approach
- Assess the potential of hierarchical endpoint analysis such as the Win-Ratio
- Explore multi-state methods and multi-task learning approaches for multi-endpoint risk prediction
- Apply methods to more complex dataset

# GitHub
The code and datasets for this project can be viewed at our GitHub repository here: <https://github.com/darshu-d/MSc-Research-project->

# References
Ascierto PA et al., SECOMBIT 4-year results. Nat Commun (2024).

Ascierto PA et al., SECOMBIT sequencing trial. J Clin Oncol (2023).

Taylor BS et al., Integrative genomic profiling of prostate cancer. Cancer Cell (2010)..





